<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Dashboard Ultimate</title>
    <link rel="icon" type="image/png" href="icon.png">
    
    <style>
        /* --- GLOBAL VARIABLES & RESET --- */
        :root {
            /* Subject Palette */
            --c-tutor: #D6B4FF;
            --c-routine: #FFC2D6;
            --c-travel: #E6B09A;
            --c-school: #80b5d0;
            --c-bio-d: #2E7D32; --c-bio-l: #C8E6C9;
            --c-chem-d: #1B5E20; --c-chem-l: #A5D6A7;
            --c-lang-d: #B71C1C; --c-lang-l: #EF9A9A;
            --c-econ-d: #4A148C; --c-econ-l: #508784;
            --c-math-d: #0D47A1; --c-math-l: #BBDEFB;
            --c-other: #FFF176;
            --c-big-study: #842e7d;

            /* UI Colors */
            --bg: #f4f6f8;
            --nav-bg: #2c3e50;
            --nav-active: #34495e;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-top: 60px; /* Space for fixed nav */
        }

        /* --- NAVIGATION BAR --- */
        .navbar {
            position: fixed; top: 0; width: 100%; height: 70px;
            background: var(--nav-bg); color: white;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .nav-left { display: flex; align-items: center; }

        .nav-centered {
            position: absolute; left: 50%; transform: translateX(-50%);
            display: flex; gap: 5px; 
        }

        .nav-right {
            display: flex; align-items: center; gap: 10px;
        }
        .daily-text-container {
            text-align: right; font-size: 0.85rem; color: #bdc3c7;
            display: flex; flex-direction: column; justify-content: center;
        }
        .daily-info-main { font-weight: bold; color: white; font-size: 1rem; }
        .daily-classes { font-size: 0.8rem; opacity: 0.8; max-width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .nav-arrow {
            background: none; border: none; color: #95a5a6; 
            font-size: 1.2rem; cursor: pointer; padding: 5px; 
            transition: color 0.2s; user-select: none;
        }
        .nav-arrow:hover { color: white; }

        .nav-btn {
            background: none; border: none; color: #bdc3c7;
            padding: 10px 15px; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .nav-btn:hover { color: white; background: rgba(255,255,255,0.1); border-radius: 4px; }
        .nav-btn.active {
            color: white; border-bottom-color: var(--c-routine);
            background: var(--nav-active); border-radius: 4px;
        }

        /* --- TABS SYSTEM --- */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- SCHEDULE GRID --- */
        .calendar-container { max-width: 1200px; margin: 0 auto; overflow-x: auto; }
        .calendar-grid {
            display: grid; grid-template-columns: 60px repeat(7, minmax(100px, 1fr));
            grid-template-rows: 40px repeat(68, 20px); 
            border: 1px solid #ddd; background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative;
        }
        .header {
            background-color: #333; color: white; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            border-right: 1px solid #555; position: sticky; top: 0; z-index: 10;
        }
        .time-label {
            grid-column: 1; background-color: #f1f1f1; color: #666;
            font-size: 0.75rem; border-bottom: 1px solid #eee; border-right: 1px solid #ddd;
            display: flex; align-items: flex-start; padding-top: 4px;
            justify-content: center; font-weight: 500;
        }
        .event {
            margin: 1px 2px; padding: 4px; border-radius: 4px; font-size: 0.75rem; 
            display: flex; flex-direction: column; justify-content: center;
            text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;
            line-height: 1.2; z-index: 2; color: black; 
        }
        .event-time { font-size: 0.65rem; opacity: 0.8; margin-top: 2px; display:block; }

        /* Colors */
        .c-tutor { background: var(--c-tutor); color: #000; }
        .c-routine { background: var(--c-routine); color: #000; }
        .c-travel { background: var(--c-travel); color: #000; }
        .c-school { background: var(--c-school); color: #fff; }
        .c-bio-d { background: var(--c-bio-d); color: #fff; }
        .c-bio-l { background: var(--c-bio-l); color: #000; }
        .c-chem-d { background: var(--c-chem-d); color: #fff; }
        .c-chem-l { background: var(--c-chem-l); color: #000; }
        .c-lang-d { background: var(--c-lang-d); color: #fff; }
        .c-lang-l { background: var(--c-lang-l); color: #000; }
        .c-econ-d { background: var(--c-econ-d); color: #fff; }
        .c-econ-l { background: var(--c-econ-l); color: #fff; }
        .c-math-d { background: var(--c-math-d); color: #fff; }
        .c-other { background: var(--c-other); color: #000; }
        .c-big-study { background: var(--c-big-study); color: #fff; }

        /* --- STRATEGY CARDS --- */
        .strategy-container { max-width: 1000px; margin: 0 auto; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .strat-card, .card {
            background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden; border-left: 6px solid #ccc; transition: transform 0.2s, box-shadow 0.2s; 
            height: 100%; display: flex; flex-direction: column; 
        }
        .strat-card:hover, .card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); cursor: pointer; }
        .card-header { padding: 15px; background: #fdfdfd; border-bottom: 1px solid #eee; font-weight: 700; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
        .card-body { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .card-body ul { margin: 0; padding-left: 20px; }
        .card-body li { margin-bottom: 8px; line-height: 1.5; }
        .card-label { font-size: 0.75rem; text-transform: uppercase; padding: 3px 8px; border-radius: 4px; background: #eee; color: #555; }
        a.card-link { text-decoration: none; color: inherit; display: block; height: 100%; }
        
        .strat-card.routine-sat { border-left-color: var(--c-routine); }
        .strat-card.routine-sun { border-left-color: var(--c-math-d); } 
        .strat-card.routine-plan { border-left-color: var(--c-big-study); }
        .strat-card.pocket-school { border-left-color: var(--c-school); }
        .strat-card.pocket-mtr { border-left-color: var(--c-travel); }
        .strat-card.subj-bio { border-left-color: var(--c-bio-d); }
        .strat-card.subj-chem { border-left-color: var(--c-chem-d); }
        .strat-card.subj-econ { border-left-color: var(--c-econ-d); }
        .strat-card.subj-lang { border-left-color: var(--c-lang-d); }
        .strat-card.subj-tok { border-left-color: var(--c-other); }
        .strat-card.subj-ee { border-left-color: var(--c-big-study); }

        /* --- DYNAMIC ATTACK CARDS (TODO) --- */
        .todo-controls { text-align: center; margin-bottom: 20px; }
        .btn-new-card {
            background: #27ae60; color: white; border: none; padding: 12px 30px; border-radius: 30px;
            font-weight: bold; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3); transition: transform 0.2s;
        }
        .btn-new-card:hover { transform: scale(1.05); }

        .attack-card {
            background: white; border-radius: 12px; margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden;
            border-left: 6px solid #ccc; transition: transform 0.2s, box-shadow 0.2s;
        }
        .attack-card.drag-over { border: 2px dashed #aaa; background: #fdfdfd; }
        .drag-handle { cursor: grab; font-size: 1.2rem; color: #ccc; margin-right: 5px; user-select: none; }
        .drag-handle:active { cursor: grabbing; color: #666; }

        .attack-card.subj-bio  { border-left-color: var(--c-bio-d); }
        .attack-card.subj-chem { border-left-color: var(--c-chem-d); }
        .attack-card.subj-math { border-left-color: var(--c-math-d); }
        .attack-card.subj-econ { border-left-color: var(--c-econ-d); }
        .attack-card.subj-eng  { border-left-color: var(--c-lang-d); }
        .attack-card.subj-chi  { border-left-color: var(--c-lang-d); } 
        .attack-card.subj-tok  { border-left-color: var(--c-other); }
        .attack-card.subj-cas  { border-left-color: #e67e22; }
        .attack-card.subj-misc { border-left-color: #bdc3c7; }

        .card-title-input { font-weight: bold; font-size: 1.1rem; border: none; background: transparent; width: 60%; color: #2c3e50; }
        .card-subject-select {
            border: none; background: #f0f0f0; padding: 8px 12px; border-radius: 8px;
            font-size: 0.85rem; font-weight: 700; color: #444; cursor: pointer; margin-right: 10px; outline: none;
        }
        .card-date-input {
            border: 1px solid #ddd; background: #fdfdfd; padding: 8px 12px; border-radius: 20px;
            font-family: inherit; font-size: 0.85rem; color: #555; cursor: pointer; margin-left: 10px; transition: all 0.2s;
        }
        .btn-delete-card { background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 1.2rem; margin-left: 10px; }

        .card-focus-strip { background: #f8f9fa; padding: 8px 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; font-size: 0.9rem; color: #555; }
        .card-focus-input { border: none; background: transparent; width: 100%; margin-left: 8px; font-weight: 600; color: #27ae60; outline: none; }

        .desc-container { border: 1px solid #eee; border-radius: 8px; background: #fff; overflow: hidden; margin-bottom: 5px; }
        .format-toolbar { display: none; background: #f8f9fa; border-bottom: 1px solid #eee; padding: 5px 10px; gap: 5px; }
        .desc-container:focus-within .format-toolbar { display: flex; }

        .format-btn { background: none; border: none; cursor: pointer; padding: 4px 8px; border-radius: 4px; font-size: 0.9rem; color: #666; font-weight: bold; }
        .format-btn:hover { background: #e2e6ea; color: #333; }

        .rich-editor { width: 100%; min-height: 22px; max-height: 300px; overflow-y: auto; padding: 5px; outline: none; font-family: inherit; font-size: 0.9rem; color: #555; box-sizing: border-box; line-height: 1.4; }
        .rich-editor[contenteditable]:empty::before { content: attr(placeholder); color: #ccc; cursor: text; display: block; }
        .rich-editor b, .rich-editor strong { font-weight: 700; color: #333; }
        .rich-editor i, .rich-editor em { font-style: italic; }
        .rich-editor ul { margin: 5px 0 5px 20px; padding: 0; }
        .rich-editor li { margin-bottom: 2px; }

        .checklist-container { margin-top: 5px; }
        .checklist-item { display: flex; align-items: center; margin-bottom: 8px; }
        .checklist-item input[type="checkbox"] { margin-right: 10px; width: 16px; height: 16px; }
        .checklist-text { flex-grow: 1; border: none; border-bottom: 1px dashed transparent; padding: 2px; font-size: 0.9rem; }
        .checklist-text:focus { border-bottom: 1px dashed #ccc; outline: none; }
        .btn-add-item { background: #eee; border: none; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; color: #555; margin-top: 5px; }

        /* --- NEW TODO LOCK SCREEN --- */
        #todo-lock-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #f4f6f8; z-index: 50;
            display: flex; justify-content: center; align-items: flex-start;
            padding-top: 100px;
        }
        .todo-lock-box {
            text-align: center; background: white; padding: 40px; 
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h2 { border-bottom: 2px solid #ddd; padding-bottom: 10px; color: #2c3e50; font-size: 1.5rem; margin-top: 30px;}
        .highlight { background: rgba(255, 255, 0, 0.15); font-weight: 600; padding: 0 4px; }
        .center-text { text-align: center; }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div id="app-content">
        
        <nav class="navbar">
            <div class="nav-left">
                <img src="icon.png" alt="Logo" style="height: 45px; width: 45px; border-radius: 50%; margin-right: 20px; border: 2px solid white;">
            </div>

            <div class="nav-centered">
                <button class="nav-btn active" onclick="switchTab('schedule', this)">üìÖ week</button>
                <button class="nav-btn" onclick="switchTab('strategy', this)">üß† strat</button>
                <button class="nav-btn" onclick="switchTab('todo', this)">‚ö° todo</button>
            </div>
            
            <div class="nav-right">
                <button class="nav-arrow" onclick="changeDay(-1)">&#10094;</button>
                <div class="daily-text-container">
                    <div class="daily-info-main" id="header-day-type">Loading...</div>
                    <div class="daily-classes" id="header-classes">...</div>
                </div>
                <button class="nav-arrow" onclick="changeDay(1)">&#10095;</button>
            </div>
        </nav>
        
        <div id="schedule" class="tab-content active">
            <div class="calendar-container">
                <h1 class="center-text">Weekly Master Schedule</h1>
                <div class="calendar-grid">
                    <div class="header">Time</div><div class="header">Mon</div><div class="header">Tue</div><div class="header">Wed</div><div class="header">Thu</div><div class="header">Fri</div><div class="header">Sat</div><div class="header">Sun</div>

                    <div class="time-label" style="grid-row: 2 / 6">06:30</div>
                    <div class="time-label" style="grid-row: 6 / 10">07:30</div>
                    <div class="time-label" style="grid-row: 10 / 14">08:30</div>
                    <div class="time-label" style="grid-row: 14 / 18">09:30</div>
                    <div class="time-label" style="grid-row: 18 / 22">10:30</div>
                    <div class="time-label" style="grid-row: 22 / 26">11:30</div>
                    <div class="time-label" style="grid-row: 26 / 30">12:30</div>
                    <div class="time-label" style="grid-row: 30 / 34">13:30</div>
                    <div class="time-label" style="grid-row: 34 / 38">14:30</div>
                    <div class="time-label" style="grid-row: 38 / 42">15:30</div>
                    <div class="time-label" style="grid-row: 42 / 46">16:30</div>
                    <div class="time-label" style="grid-row: 46 / 50">17:30</div>
                    <div class="time-label" style="grid-row: 50 / 54">18:30</div>
                    <div class="time-label" style="grid-row: 54 / 58">19:30</div>
                    <div class="time-label" style="grid-row: 58 / 62">20:30</div>
                    <div class="time-label" style="grid-row: 62 / 66">21:30</div>
                    <div class="time-label" style="grid-row: 66 / 70">22:30</div>

                    <div class="event c-routine" style="grid-column: 2; grid-row: 2 / 4;">Wake Up</div>
                    <div class="event c-routine" style="grid-column: 3; grid-row: 2 / 4;">Wake Up</div>
                    <div class="event c-routine" style="grid-column: 4; grid-row: 2 / 4;">Wake Up</div>
                    <div class="event c-routine" style="grid-column: 5; grid-row: 2 / 4;">Wake Up</div>
                    <div class="event c-routine" style="grid-column: 6; grid-row: 2 / 4;">Wake Up</div>
                    <div class="event c-routine" style="grid-column: 7; grid-row: 2 / 6;">Wake Up & Bkfst</div>
                    <div class="event c-routine" style="grid-column: 8; grid-row: 2 / 6;">Wake Up & Bkfst</div>
                    <div class="event c-routine" style="grid-column: 2; grid-row: 4 / 6;">Breakfast</div>
                    <div class="event c-routine" style="grid-column: 3; grid-row: 4 / 6;">Breakfast</div>
                    <div class="event c-routine" style="grid-column: 4; grid-row: 4 / 6;">Breakfast</div>
                    <div class="event c-routine" style="grid-column: 5; grid-row: 4 / 6;">Breakfast</div>
                    <div class="event c-routine" style="grid-column: 6; grid-row: 4 / 6;">Breakfast</div>

                    <div class="event c-travel" style="grid-column: 2; grid-row: 6 / 10;">Travel to School</div>
                    <div class="event c-school" style="grid-column: 2; grid-row: 10 / 37;">School<br><span class="event-time">08:25 - 15:10</span></div>
                    <div class="event c-travel" style="grid-column: 2; grid-row: 37 / 41;">Travel to PE</div>
                    
                    <div class="event c-econ-l" style="grid-column: 2; grid-row: 41 / 48;">Gap Block<br><span class="event-time">Chi/Econ</span></div>
                    
                    <div class="event c-tutor" style="grid-column: 2; grid-row: 48 / 54;">Chinese Tutor</div>
                    <div class="event c-travel" style="grid-column: 2; grid-row: 54 / 57;">Travel Home</div>
                    <div class="event c-routine" style="grid-column: 2; grid-row: 57 / 59;">Dinner<br><span class="event-time">20:15</span></div>
                    <div class="event c-routine" style="grid-column: 2; grid-row: 59 / 61;">Shower</div>
                    <div class="event c-chem-l" style="grid-column: 2; grid-row: 61 / 64;">Chem Review</div>
                    <div class="event c-routine" style="grid-column: 2; grid-row: 64 / 68;">Wind Down</div>

                    <div class="event c-travel" style="grid-column: 3; grid-row: 6 / 10;">Travel to School</div>
                    <div class="event c-school" style="grid-column: 3; grid-row: 10 / 37;">School<br><span class="event-time">08:25 - 15:10</span></div>
                    <div class="event c-travel" style="grid-column: 3; grid-row: 37 / 39;">Travel Shek Mun</div>
                    <div class="event c-tutor" style="grid-column: 3; grid-row: 39 / 43;">Bio Tutor</div>
                    <div class="event c-travel" style="grid-column: 3; grid-row: 43 / 48;">Travel Home (Long)</div>
                    <div class="event c-routine" style="grid-column: 3; grid-row: 48 / 50;">Dinner<br><span class="event-time">18:00</span></div>
                    <div class="event c-routine" style="grid-column: 3; grid-row: 50 / 52;">Shower</div>
                    <div class="event c-math-d" style="grid-column: 3; grid-row: 52 / 56;">Deep Math/Chem</div>
                    <div class="event c-lang-l" style="grid-column: 3; grid-row: 56 / 60;">Lang & Bio Rev</div>
                    <div class="event c-routine" style="grid-column: 3; grid-row: 60 / 66;">Free Time</div>
                    <div class="event c-routine" style="grid-column: 3; grid-row: 66 / 68;">Wind Down</div>

                    <div class="event c-travel" style="grid-column: 4; grid-row: 6 / 10;">Travel to School</div>
                    <div class="event c-school" style="grid-column: 4; grid-row: 10 / 37;">School<br><span class="event-time">08:25 - 15:10</span></div>
                    <div class="event c-travel" style="grid-column: 4; grid-row: 37 / 41;">Travel to PE</div>
                    
                    <div class="event c-econ-l" style="grid-column: 4; grid-row: 41 / 48;">Gap Block<br><span class="event-time">Eng/Econ</span></div>
                    
                    <div class="event c-tutor" style="grid-column: 4; grid-row: 48 / 54;">English Tutor</div>
                    <div class="event c-travel" style="grid-column: 4; grid-row: 54 / 57;">Travel Home</div>
                    <div class="event c-routine" style="grid-column: 4; grid-row: 57 / 59;">Dinner<br><span class="event-time">20:15</span></div>
                    <div class="event c-routine" style="grid-column: 4; grid-row: 59 / 61;">Shower</div>
                    <div class="event c-bio-l" style="grid-column: 4; grid-row: 61 / 64;">Bio Review</div>
                    <div class="event c-routine" style="grid-column: 4; grid-row: 64 / 68;">Wind Down</div>

                    <div class="event c-travel" style="grid-column: 5; grid-row: 6 / 10;">Travel to School</div>
                    <div class="event c-school" style="grid-column: 5; grid-row: 10 / 37;">School<br><span class="event-time">08:25 - 15:10</span></div>
                    <div class="event c-travel" style="grid-column: 5; grid-row: 37 / 38;">Rush</div>
                    <div class="event c-tutor" style="grid-column: 5; grid-row: 38 / 42;">Chem Tutor</div>
                    <div class="event c-travel" style="grid-column: 5; grid-row: 42 / 46;">Travel Home</div>
                    <div class="event c-routine" style="grid-column: 5; grid-row: 46 / 48;">Dinner</div>
                    <div class="event c-routine" style="grid-column: 5; grid-row: 48 / 50;">Free Time</div>
                    <div class="event c-routine" style="grid-column: 5; grid-row: 50 / 52;">Shower</div>
                    <div class="event c-other" style="grid-column: 5; grid-row: 52 / 56;">TOK / EE / Lang</div>
                    <div class="event c-tutor" style="grid-column: 5; grid-row: 56 / 62;">Chinese Class (ÈáëÈáë)<br><span class="event-time">20:00 - 21:30</span></div>
                    <div class="event c-chem-l" style="grid-column: 5; grid-row: 62 / 66;">Chem Post-Rev</div>
                    <div class="event c-routine" style="grid-column: 5; grid-row: 66 / 68;">Wind Down</div>

                    <div class="event c-travel" style="grid-column: 6; grid-row: 6 / 10;">Travel to School</div>
                    <div class="event c-school" style="grid-column: 6; grid-row: 10 / 28;">School<br><span class="event-time">08:25 - 13:00</span></div>
                    <div class="event c-routine" style="grid-column: 6; grid-row: 28 / 36;">Lunch Friends</div>
                    <div class="event c-travel" style="grid-column: 6; grid-row: 36 / 40;">Travel Home</div>
                    <div class="event c-econ-d" style="grid-column: 6; grid-row: 40 / 48;">Study Econ & HW</div>
                    <div class="event c-routine" style="grid-column: 6; grid-row: 48 / 52;">Light Dinner</div>
                    <div class="event c-travel" style="grid-column: 6; grid-row: 52 / 55;">Travel</div>
                    <div class="event c-tutor" style="grid-column: 6; grid-row: 55 / 62;">Ballet</div>
                    <div class="event c-travel" style="grid-column: 6; grid-row: 62 / 64;">Home</div>
                    <div class="event c-routine" style="grid-column: 6; grid-row: 64 / 66;">Shower</div>
                    <div class="event c-routine" style="grid-column: 6; grid-row: 66 / 68;">Wind Down</div>

                    <div class="event c-lang-l" style="grid-column: 7; grid-row: 6 / 14;">Eng Read & CAS<br><span class="event-time">07:30 - 09:30</span></div>
                    <div class="event c-routine" style="grid-column: 7; grid-row: 14 / 18;">Prep<br><span class="event-time">09:30 - 10:00</span></div>
                    <div class="event c-tutor" style="grid-column: 7; grid-row: 18 / 22;">Chinese Tutor<br><span class="event-time">10:00 - 11:00</span></div>
                    <div class="event c-bio-l" style="grid-column: 7; grid-row: 22 / 26;">Science Prep<br><span class="event-time">11:00 - 12:00</span></div>
                    <div class="event c-routine" style="grid-column: 7; grid-row: 26 / 31;">Lunch & Prep<br><span class="event-time">12:00 - 13:15</span></div>
                    <div class="event c-travel" style="grid-column: 7; grid-row: 31 / 34;">Travel Kowloon<br><span class="event-time">13:15 - 14:00</span></div>
                    <div class="event c-other" style="grid-column: 7; grid-row: 34 / 42;">Tutor w/ Smile<br><span class="event-time">14:00 - 16:00</span></div>
                    <div class="event c-travel" style="grid-column: 7; grid-row: 42 / 45;">Travel Home</div>
                    <div class="event c-routine" style="grid-column: 7; grid-row: 45 / 48;">Rest</div>
                    <div class="event c-tutor" style="grid-column: 7; grid-row: 48 / 54;">Bio/Chem Pvt Tutor</div>
                    <div class="event c-routine" style="grid-column: 7; grid-row: 54 / 56;">Dinner</div>
                    <div class="event c-tutor" style="grid-column: 7; grid-row: 56 / 60;">Eng Tutor</div>
                    <div class="event c-routine" style="grid-column: 7; grid-row: 60 / 62;">Shower</div>
                    <div class="event c-routine" style="grid-column: 7; grid-row: 62 / 68;">Movie Night</div>

                    <div class="event c-math-d" style="grid-column: 8; grid-row: 6 / 12;">Math AA Practice<br><span class="event-time">07:30 - 09:00</span></div>
                    <div class="event c-routine" style="grid-column: 8; grid-row: 12 / 18;">Free Time</div>
                    <div class="event c-travel" style="grid-column: 8; grid-row: 18 / 20;">Travel</div>
                    <div class="event c-tutor" style="grid-column: 8; grid-row: 20 / 26;">Ballet</div>
                    <div class="event c-travel" style="grid-column: 8; grid-row: 26 / 32;">Lunch & Travel</div>
                    <div class="event c-big-study" style="grid-column: 8; grid-row: 32 / 44;">Big Study<br><span class="event-time">Econ & Sci</span></div>
                    <div class="event c-routine" style="grid-column: 8; grid-row: 44 / 50;">Free Time</div>
                    <div class="event c-routine" style="grid-column: 8; grid-row: 50 / 52;">Dinner</div>
                    <div class="event c-other" style="grid-column: 8; grid-row: 52 / 56;">Internship</div>
                    <div class="event c-routine" style="grid-column: 8; grid-row: 56 / 58;">Shower</div>
                    <div class="event c-other" style="grid-column: 8; grid-row: 58 / 62;">Planning</div>
                    <div class="event c-routine" style="grid-column: 8; grid-row: 62 / 66;">Reading</div>
                    <div class="event c-routine" style="grid-column: 8; grid-row: 66 / 68;">Wind Down</div>
                    
                    <div class="event c-routine" style="grid-column: 2 / 9; grid-row: 68 / 70; background-color: #333; color: white; display:flex; align-items:center; justify-content:center; font-weight:bold;">SLEEP</div>
                </div>
            </div>
        </div>

        <div id="strategy" class="tab-content">
            <div class="strategy-container">
                <h1 class="center-text">
                    <a href="https://www.notion.so/chiuy6/74ecf570ba6542158d61dd82d6b7b365" target="_blank" style="text-decoration:none; color:inherit;">
                        üß† IBDP Strategy Visualizer
                    </a>
                </h1>
                
                <div class="center-text"><h2>üåÖ Weekly Routine Strategy</h2></div>
                <div class="card-grid">
                    <div class="strat-card card routine-sat">
                        <div class="card-header">Saturday Morning <span class="card-label">Low Intensity</span></div>
                        <div class="card-body">
                            <ul>
                                <li><strong>English L&L Reading:</strong> Sticky note quotes for <span class="highlight">literary devices</span> immediately. Saves Paper 2 prep time.</li>
                                <li><strong>CAS Portfolio:</strong> Update reflections weekly. Upload photos now.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="strat-card card routine-sun">
                        <div class="card-header">Sunday Morning <span class="card-label" style="background: var(--c-math-d); color: white;">High Priority</span></div>
                        <div class="card-body">
                            <ul>
                                <li><strong>Math AA SL (07:30 - 09:00):</strong> Do this when fresh.</li>
                                <li><strong>Traffic Light System:</strong> Mark questions Red/Amber/Green.</li>
                                <li><strong>Mistake Notebook:</strong> Copy 'Red' questions to re-attempt blindly.</li>
                            </ul>
                        </div>
                    </div>
                    <a href="#" class="card-link" title="Open Planning Checklist">
                        <div class="strat-card card routine-plan">
                            <div class="card-header">Sunday Evening <span class="card-label" style="background: var(--c-big-study); color: white;">Executive</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Deadline Audit:</strong> Check ManageBac (Catch surprise IAs!).</li>
                                    <li><strong>Tutor DM:</strong> Message tutors specific questions <em>now</em>.</li>
                                    <li><strong>Pack:</strong> Gym kit & HW. Avoid morning chaos.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                </div>

                <div class="center-text"><h2>üöÄ Hidden Time Pockets</h2></div>
                <div class="card-grid">
                    <div class="strat-card card pocket-school">
                        <div class="card-header">üè´ School Free Periods <span class="card-label">Clear the Deck</span></div>
                        <div class="card-body">
                            <ul>
                                <li><strong>Homework Rule:</strong> Finish tonight's drills <em>at school</em>.</li>
                                <li><strong>Review Sandwich:</strong> First 5 mins: Review notes from previous class.</li>
                                <li><strong>Pre-Tutor:</strong> Organize questions for evening session.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="strat-card card pocket-mtr">
                        <div class="card-header">üöá MTR Transit Strategy <span class="card-label">Adaptive</span></div>
                        <div class="card-body">
                            <div style="margin-bottom: 5px;"><strong>ü™ë Seated:</strong> Anki Flashcards (Bio/Chem/Idioms).</div>
                            <div style="margin-bottom: 5px;"><strong>üßç Standing:</strong> Econ news podcasts or Audiobooks.</div>
                            <div><strong>üò¥ Tired:</strong> <span class="highlight">Rest.</span> A rested brain learns better.</div>
                        </div>
                    </div>
                </div>

                <div class="center-text"><h2>üìö Subject-Specific Tactics</h2></div>
                <div class="card-grid">
                    <a href="https://www.notion.so/chiuy6/bio-2516ca83c26681679695ff4929ee675a" class="card-link" target="_blank">
                        <div class="strat-card card subj-bio">
                            <div class="card-header">üß¨ HL Biology <span class="card-label">Understanding</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Feynman:</strong> Teach concepts out loud.</li>
                                    <li><strong>IB Guide:</strong> Check syllabus statements for exact content.</li>
                                    <li><strong>"Surgery":</strong> Check Mark Scheme for scoring keywords.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.notion.so/chiuy6/chem-2516ca83c2668163ba71cc3277d09686" class="card-link" target="_blank">
                        <div class="strat-card card subj-chem">
                            <div class="card-header">üß™ HL Chemistry <span class="card-label">Deep Mastery</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Recall Drills:</strong> Draw Organic pathways & VSEPR from memory.</li>
                                    <li><strong>Quant Algorithms:</strong> Write "Step-by-Step Recipes".</li>
                                    <li><strong>Anki Rigor:</strong> If not word-for-word, press "Again".</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.notion.so/chiuy6/econ-2516ca83c26681ea8d18f94cdd216d82" class="card-link" target="_blank">
                        <div class="strat-card card subj-econ">
                            <div class="card-header">üìà HL Economics <span class="card-label">Definitions</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>3-Step Drill:</strong> Define ‚Üí Diagram (Memory) ‚Üí Explain.</li>
                                    <li><strong>RWE:</strong> 1 news headline per week for Paper 1.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.notion.so/chiuy6/AASL-2516ca83c266814ba8fec3f671f105c1" class="card-link" target="_blank">
                        <div class="strat-card card" style="border-left-color: var(--c-math-d);">
                            <div class="card-header">üßÆ Math AASL <span class="card-label">Practice</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Traffic Light:</strong> Mark Qs Red/Amber/Green.</li>
                                    <li><strong>Mistake Notebook:</strong> Re-attempt reds blindly.</li>
                                    <li><strong>Formulas:</strong> Memorize locations in booklet.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.notion.so/chiuy6/english-2516ca83c26681e3ac0cde8b39614e50" class="card-link" target="_blank">
                        <div class="strat-card card subj-lang">
                            <div class="card-header">üìñ English L&L <span class="card-label">Structure</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Skeleton Plan:</strong> Write Topic Sentences only first.</li>
                                    <li><strong>PEEL Check:</strong> Link to Global Issue every paragraph.</li>
                                    <li><strong>Sticky Notes:</strong> Mark literary devices & choices.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.notion.so/chiuy6/chinese-2516ca83c26681308b33c691c0f0eaca" class="card-link" target="_blank">
                        <div class="strat-card card subj-lang">
                            <div class="card-header">üó£Ô∏è Chinese B <span class="card-label">Rotation</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Cycle:</strong> Reading ‚Üí Listening ‚Üí Writing.</li>
                                    <li><strong>Daily Input:</strong> Add unknown words to Anki.</li>
                                    <li><strong>Dictation:</strong> Tue/Thu. Listen ‚Üí Write character.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                    <a href="#" class="card-link">
                        <div class="strat-card card subj-ee">
                            <div class="card-header">üìù Extended Essay <span class="card-label" style="background: var(--c-big-study); color: white;">Urgent</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>Sacred Hour (Thu 18:30):</strong> Strict production time.</li>
                                    <li><strong>Phase 1:</strong> Bullet outline & source map.</li>
                                    <li><strong>Phase 2 (Ugly Draft):</strong> 500 words/hr. No editing.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.notion.so/chiuy6/tok-2696ca83c26680c5ad58ff4d441acf7a" class="card-link" target="_blank">
                        <div class="strat-card card subj-tok">
                            <div class="card-header">üß† TOK <span class="card-label" style="background: var(--c-other); color: black;">Slow Burn</span></div>
                            <div class="card-body">
                                <ul>
                                    <li><strong>TOK Journal:</strong> Ask "How do we know this is true?"</li>
                                    <li><strong>Concepts:</strong> Tag <em>Bias, Certainty, Truth</em>.</li>
                                </ul>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <div id="todo" class="tab-content">
            <div style="position:relative; min-height: 500px;">
                
                <div id="todo-lock-overlay">
                    <div class="todo-lock-box">
                        <h2 style="margin-top:0;">‚ö° Mission Control</h2>
                        <p style="color:#666; margin-bottom:20px;">Restricted Access</p>
                        <input type="password" id="todo-pass-input" placeholder="Enter PIN" style="padding:10px; width:150px; text-align:center; border:2px solid #ddd; border-radius:6px;">
                        <br><br>
                        <button onclick="unlockTodo()" style="background:#2c3e50; color:white; border:none; padding:10px 25px; border-radius:6px; cursor:pointer; font-weight:bold;">Unlock</button>
                        <p id="todo-error" style="color:red; display:none; margin-top:10px;">Incorrect</p>
                    </div>
                </div>

                <div class="attack-container" style="max-width: 700px; margin: 0 auto; padding-top: 20px;">
                    
                    <h1 class="center-text">
                        <a href="https://www.notion.so/chiuy6/7eb3b8db768a4b43944072135d485e9b?v=3c8265dde3bc4017b8a8fb42289234a6&source=copy_link" target="_blank" style="text-decoration:none; color:inherit;">
                            ‚ö° todo!
                        </a>
                    </h1>

                    <div class="todo-controls" style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                        <button class="btn-new-card" onclick="createNewCard()">+ New Mission</button>
                        
                        <select onchange="sortCards(this.value)" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd; background: white; cursor: pointer;">
                            <option value="manual">Manual Order</option>
                            <option value="date">Sort by Date (Soonest)</option>
                            <option value="subject">Sort by Subject</option>
                        </select>
                    </div>

                    <div id="dynamic-todo-container">
                        </div>

                </div>
            </div>
        </div>

    </div> <script>
    // --- 1. FORMATTING TOOL (MUST BE AT THE TOP) ---
    window.formatDoc = function(cmd) {
        document.execCommand(cmd, false, null);
        // Force focus back to the editor just in case
        var editor = document.activeElement; 
        if(editor) editor.focus(); 
    }

    // --- 2. DATA STORAGE ---
    var todoCards = JSON.parse(localStorage.getItem('ib_dynamic_cards')) || [];
    var draggedItemIndex = null;

    // --- 3. LOCK SCREEN LOGIC (LOCAL TO TODO TAB) ---
    var validPass = "ib45!"; 
    
    // Check if previously unlocked in this session
    var isUnlocked = sessionStorage.getItem('todo_unlocked') === 'true';

    function unlockTodo() {
        var input = document.getElementById('todo-pass-input');
        if (input.value === validPass) {
            document.getElementById('todo-lock-overlay').style.display = 'none';
            sessionStorage.setItem('todo_unlocked', 'true');
            isUnlocked = true;
        } else {
            document.getElementById('todo-error').style.display = 'block';
            input.style.border = "2px solid red";
        }
    }

    // Handle Enter Key on Lock Screen
    document.addEventListener('DOMContentLoaded', function() {
        var passInput = document.getElementById('todo-pass-input');
        if(passInput) {
            passInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') unlockTodo();
            });
        }
        
        // Auto-unlock if session remains
        if(isUnlocked) {
            document.getElementById('todo-lock-overlay').style.display = 'none';
        }

        renderCards(); 
        updateDailyHeader(); 
        setInterval(updateDailyHeader, 1000 * 60 * 60);
    });

    // --- 4. TABS & NAV ---
    window.switchTab = function(tabId, btnElement) {
        var contents = document.querySelectorAll('.tab-content');
        for (var i = 0; i < contents.length; i++) contents[i].classList.remove('active');
        var buttons = document.querySelectorAll('.nav-btn');
        for (var i = 0; i < buttons.length; i++) buttons[i].classList.remove('active');
        
        var target = document.getElementById(tabId);
        if (target) target.classList.add('active');
        if (btnElement) btnElement.classList.add('active');
        localStorage.setItem('lastActiveTab', tabId);
        window.scrollTo(0, 0);
    }

    function restoreTab() {
        var savedTabId = localStorage.getItem('lastActiveTab');
        if (savedTabId) {
            var targetBtn = document.querySelector(".nav-btn[onclick*='" + savedTabId + "']");
            if (targetBtn) switchTab(savedTabId, targetBtn);
        }
    }

    // --- 5. SORTING LOGIC ---
    window.sortCards = function(criteria) {
        if (criteria === 'date') {
            todoCards.sort(function(a, b) {
                if(!a.date) return 1; 
                if(!b.date) return -1;
                return new Date(a.date) - new Date(b.date);
            });
        } 
        else if (criteria === 'subject') {
            todoCards.sort(function(a, b) {
                var sA = a.subject || "zz"; 
                var sB = b.subject || "zz";
                return sA.localeCompare(sB);
            });
        }
        // 'manual' does nothing (we just rely on array order)
        saveAndRender();
    }

    // --- 6. DRAG AND DROP HANDLERS ---
    window.handleDragStart = function(e, index) {
        draggedItemIndex = index;
        e.dataTransfer.effectAllowed = 'move';
        e.target.style.opacity = '0.4';
    }
    window.handleDragOver = function(e) {
        if (e.preventDefault) e.preventDefault(); 
        e.dataTransfer.dropEffect = 'move';
        return false;
    }
    window.handleDragEnter = function(e) { this.classList.add('drag-over'); }
    window.handleDragLeave = function(e) { this.classList.remove('drag-over'); }
    window.handleDrop = function(e, targetIndex) {
        if (e.stopPropagation) e.stopPropagation();
        var item = todoCards.splice(draggedItemIndex, 1)[0];
        todoCards.splice(targetIndex, 0, item);
        saveAndRender();
        return false;
    }
    window.handleDragEnd = function(e) {
        this.style.opacity = '1'; 
        document.querySelectorAll('.attack-card').forEach(function(card) {
            card.classList.remove('drag-over');
        });
    }

    // --- 7. RENDER CARDS (Main Logic) ---
    window.renderCards = function() {
        var container = document.getElementById('dynamic-todo-container');
        if (!container) return;
        container.innerHTML = ""; 

        todoCards.forEach(function(card, cardIndex) {
            
            // A. DATE COLOR LOGIC
            var dateColor = "#fdfdfd"; 
            if (card.date) {
                var today = new Date();
                today.setHours(0,0,0,0);
                var due = new Date(card.date);
                var diffDays = Math.ceil((due - today) / (1000 * 60 * 60 * 24)); 
                if (diffDays < 0) dateColor = "#A9E5F5";      
                else if (diffDays <= 1) dateColor = "#ffcdd2"; 
                else if (diffDays <= 6) dateColor = "#ffe0b2"; 
                else if (diffDays <= 14) dateColor = "#F5D97F";
                else dateColor = "#C8E6C9";                    
            }

            // B. SUBJECT COLOR LOGIC
            var subjectClass = "subj-misc"; 
            if (card.subject === "bio") subjectClass = "subj-bio";
            if (card.subject === "chem") subjectClass = "subj-chem";
            if (card.subject === "math") subjectClass = "subj-math";
            if (card.subject === "econ") subjectClass = "subj-econ";
            if (card.subject === "eng") subjectClass = "subj-eng";
            if (card.subject === "chi") subjectClass = "subj-chi"; /* CHINESE */
            if (card.subject === "tok") subjectClass = "subj-tok";
            if (card.subject === "cas") subjectClass = "subj-cas";

            // C. CREATE CARD HTML
            var cardDiv = document.createElement('div');
            cardDiv.className = `attack-card ${subjectClass}`;
            
            // Enable Dragging
            cardDiv.setAttribute('draggable', 'true');
            cardDiv.addEventListener('dragstart', function(e) { handleDragStart(e, cardIndex); });
            cardDiv.addEventListener('dragover', handleDragOver);
            cardDiv.addEventListener('dragenter', handleDragEnter);
            cardDiv.addEventListener('dragleave', handleDragLeave);
            cardDiv.addEventListener('drop', function(e) { handleDrop(e, cardIndex); });
            cardDiv.addEventListener('dragend', handleDragEnd);

            var checklistHTML = "";
            card.checklist.forEach(function(item, itemIndex) {
                var checked = item.done ? 'checked' : '';
                var strike = item.done ? 'text-decoration:line-through; color:#aaa;' : '';
                checklistHTML += `
                    <div class="checklist-item">
                        <input type="checkbox" onchange="toggleCheck(${cardIndex}, ${itemIndex})" ${checked}>
                        <input type="text" class="checklist-text" value="${item.text}" 
                               style="${strike}" 
                               oninput="updateCheckText(${cardIndex}, ${itemIndex}, this.value)"
                               placeholder="Task step...">
                        <button onclick="deleteCheckItem(${cardIndex}, ${itemIndex})" style="color:#ccc; border:none; background:none; cursor:pointer;">&times;</button>
                    </div>
                `;
            });

            cardDiv.innerHTML = `
                <div class="card-header" style="flex-wrap: wrap; gap: 10px;">
                    <span class="drag-handle" title="Drag to reorder">‚ãÆ‚ãÆ</span>

                    <input type="text" class="card-title-input" value="${card.title}" 
                           oninput="updateCard(${cardIndex}, 'title', this.value)" 
                           placeholder="Mission Title"
                           style="flex-grow: 1; min-width: 150px;">

                    <div style="display:flex; align-items:center;">
                        <select class="card-subject-select" onchange="updateCard(${cardIndex}, 'subject', this.value)">
                            <option value="misc" ${card.subject=='misc'?'selected':''}>General</option>
                            <option value="bio"  ${card.subject=='bio'?'selected':''}>Bio üß¨</option>
                            <option value="chem" ${card.subject=='chem'?'selected':''}>Chem üß™</option>
                            <option value="math" ${card.subject=='math'?'selected':''}>Math üßÆ</option>
                            <option value="econ" ${card.subject=='econ'?'selected':''}>Econ üìà</option>
                            <option value="eng"  ${card.subject=='eng'?'selected':''}>Eng üìñ</option>
                            <option value="chi"  ${card.subject=='chi'?'selected':''}>Chinese üêâ</option>
                            <option value="tok"  ${card.subject=='tok'?'selected':''}>TOK üß†</option>
                            <option value="cas"  ${card.subject=='cas'?'selected':''}>CAS üé®</option>
                        </select>

                        <input type="date" class="card-date-input" value="${card.date}" 
                               onchange="updateCard(${cardIndex}, 'date', this.value)"
                               style="background-color: ${dateColor}; border: 1px solid rgba(0,0,0,0.1); font-weight: 500;">
                        
                        <button class="btn-delete-card" onclick="deleteCard(${cardIndex})">&times;</button>
                    </div>
                </div>

                <div class="card-focus-strip">
                    üéØ 
                    <input type="text" class="card-focus-input" value="${card.focus || ''}" 
                           oninput="updateCard(${cardIndex}, 'focus', this.value)" 
                           placeholder="Primary Objective...">
                </div>

                <div class="card-body">
                    <div class="desc-container">
                        <div class="format-toolbar">
                            <button class="format-btn" onmousedown="event.preventDefault();" onclick="formatDoc('bold')" title="Bold">B</button>
                            <button class="format-btn" onmousedown="event.preventDefault();" onclick="formatDoc('italic')" title="Italic" style="font-style:italic;">I</button>
                            <button class="format-btn" onmousedown="event.preventDefault();" onclick="formatDoc('underline')" title="Underline" style="text-decoration:underline;">U</button>
                            <span style="border-right:1px solid #ddd; margin: 0 5px;"></span>
                            <button class="format-btn" onmousedown="event.preventDefault();" onclick="formatDoc('insertUnorderedList')" title="Bullet List">‚Ä¢ List</button>
                        </div>

                        <div class="rich-editor" contenteditable="true" 
                             placeholder="Mission details..."
                             oninput="updateCard(${cardIndex}, 'desc', this.innerHTML)">
                             ${card.desc}
                        </div>
                    </div>

                    <div class="checklist-container">
                        ${checklistHTML}
                        <button class="btn-add-item" onclick="addCheckItem(${cardIndex})">+ Add Step</button>
                    </div>
                </div>
            `;
            container.appendChild(cardDiv);
        });
    }

    // --- 8. CARD ACTIONS ---
    window.createNewCard = function() {
        todoCards.push({ title: "", subject: "misc", focus: "", date: "", desc: "", checklist: [] });
        saveAndRender();
    }
    window.updateCard = function(index, field, value) {
        todoCards[index][field] = value;
        if (field === 'subject' || field === 'date') saveAndRender(); // Re-render for color changes
        else saveCards(); 
    }
    window.deleteCard = function(index) {
        if(confirm("Delete this mission block?")) {
            todoCards.splice(index, 1);
            saveAndRender();
        }
    }

    // --- 9. CHECKLIST ACTIONS ---
    window.addCheckItem = function(cardIndex) {
        todoCards[cardIndex].checklist.push({ text: "", done: false });
        saveAndRender();
    }
    window.toggleCheck = function(cardIndex, itemIndex) {
        todoCards[cardIndex].checklist[itemIndex].done = !todoCards[cardIndex].checklist[itemIndex].done;
        saveAndRender();
    }
    window.updateCheckText = function(cardIndex, itemIndex, text) {
        todoCards[cardIndex].checklist[itemIndex].text = text;
        saveCards();
    }
    window.deleteCheckItem = function(cardIndex, itemIndex) {
        todoCards[cardIndex].checklist.splice(itemIndex, 1);
        saveAndRender();
    }

    // --- 10. DAILY HEADER & CYCLING LOGIC ---
    // A. CONFIGURATION
    var scheduleWeekA = {
        1: "Econ ‚Ä¢ Bio ‚Ä¢ Tok ‚Ä¢ --",        // Mon
        2: "Chem ‚Ä¢ Tok ‚Ä¢ Econ ‚Ä¢ Eng",        // Tue
        3: "Math ‚Ä¢ PSE ‚Ä¢ Bio ‚Ä¢ Chin",      // Wed
        4: "Bio ‚Ä¢ Eng ‚Ä¢ Econ ‚Ä¢ Chem",         // Thu
        5: "Chin ‚Ä¢ Chem ‚Ä¢ Math"         // Fri
    };
    var scheduleWeekB = {
        1: "Bio ‚Ä¢ Chem ‚Ä¢ Math ‚Ä¢ Eng",        // Mon
        2: "-- ‚Ä¢ -- ‚Ä¢ Chin ‚Ä¢ Bio",        // Tue
        3: "Tok ‚Ä¢ Chem ‚Ä¢ Eng ‚Ä¢ Econ",      // Wed
        4: "Bio ‚Ä¢ Econ ‚Ä¢ Math ‚Ä¢ --",         // Thu
        5: "Chem ‚Ä¢ Eng ‚Ä¢ Chin"         // Fri
    };
    
    // B. LOGIC
    var referenceWeekA = new Date('2026-01-05'); // Monday of a Week A
    var dayOffset = 0; // 0 = Today, 1 = Tomorrow, etc.

    function changeDay(delta) {
        dayOffset += delta;
        updateDailyHeader();
    }

    function updateDailyHeader() {
        var targetDate = new Date(); // Start at actual today
        // Apply Offset
        targetDate.setDate(targetDate.getDate() + dayOffset);

        var dayOfWeek = targetDate.getDay(); 
        var typeElem = document.getElementById('header-day-type');
        var classesElem = document.getElementById('header-classes');

        // Helper label for Today/Tmrw
        var relLabel = "";
        if (dayOffset === 0) relLabel = "";
        else if (dayOffset === 1) relLabel = " (Tom)";
        else if (dayOffset === -1) relLabel = " (Yest)";
        else relLabel = " (" + (targetDate.getMonth()+1) + "/" + targetDate.getDate() + ")";

        // Weekend Logic
        if (dayOfWeek === 0) {
            typeElem.innerText = "Sunday! ‚òÄÔ∏è" + relLabel;
            classesElem.innerText = "Rest & Prep Strategy";
            return;
        }
        if (dayOfWeek === 6) {
            typeElem.innerText = "Saturday!" + relLabel;
            classesElem.innerText = "Low Intensity Routine";
            return;
        }

        // Week A/B Logic
        var oneDay = 24 * 60 * 60 * 1000;
        var diffDays = Math.round((targetDate - referenceWeekA) / oneDay);
        var diffWeeks = Math.floor(diffDays / 7);
        
        var isWeekA = (diffWeeks % 2 === 0);
        var weekLabel = isWeekA ? "Week 1" : "Week 2";
        var dayLabel = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][dayOfWeek];

        typeElem.innerText = `${weekLabel} - ${dayLabel}${relLabel}`;

        // Get Classes
        var currentSchedule = isWeekA ? scheduleWeekA : scheduleWeekB;
        var todaysClasses = currentSchedule[dayOfWeek] || "No classes";
        classesElem.innerText = todaysClasses;
    }

    // --- 11. SAVE HELPERS ---
    function saveCards() { localStorage.setItem('ib_dynamic_cards', JSON.stringify(todoCards)); }
    function saveAndRender() { saveCards(); renderCards(); }

</script>
</body>
</html>
